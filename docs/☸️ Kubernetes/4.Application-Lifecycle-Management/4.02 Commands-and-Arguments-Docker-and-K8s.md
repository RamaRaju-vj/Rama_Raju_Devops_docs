
# 4.02  Commands and Arguments in Docker & Kubernetes

This guide explains how **commands and arguments** work in both **Docker** and **Kubernetes** in a simple way.

It focuses on:

- How containers decide what to run at startup
- How CMD and ENTRYPOINT behave in Docker
- How Kubernetes `command` and `args` override image behavior
- Correct patterns and common mistakes



---

# ğŸ³ Commands and Arguments in Docker

Docker containers run **one main process**. When that process exits, the container stops.

---

## ğŸ¯ Core Concept â€” Container = Main Process

A container is not a virtual machine. It does not boot an OS.  
It runs a **single primary process**.

Lifecycle:

```
Container start â†’ Main process runs â†’ Process exits â†’ Container stops
```

Startup command can come from:

- Dockerfile `CMD`
- Dockerfile `ENTRYPOINT`
- Command passed in `docker run`

!!! note
    If there is no longâ€‘running process = container exits immediately.

---

## â–¶ï¸ Why `docker run ubuntu` Stops Immediately

=== "Run"

    ```bash
    docker run ubuntu
    ```

What happens:

- Ubuntu image default command = bash
- No interactive terminal attached
- bash exits
- container stops

=== "Verify"

    ```bash
    docker ps
    docker ps -a
    ```

!!! warning
    If the startup command finishes, container status becomes **Exited**.

---

## â±ï¸ Override Default Command at Runtime

Anything after the image name overrides Dockerfile **CMD**.

```bash
docker run ubuntu sleep 5
```

Final startup command:

```
sleep 5
```

!!! tip
    Runtime command replaces CMD completely.

---

## ğŸ§± CMD â€” Default Command

CMD defines the **default command + arguments** if none are provided at runtime.

=== "Shell Form"

    ```dockerfile
    CMD sleep 5
    ```

=== "Exec (JSON) Form â€” Recommended"

    ```dockerfile
    CMD ["sleep", "5"]
    ```

!!! success
    Always prefer JSON form â€” safer argument parsing.

---

## âŒ Wrong CMD JSON Format

```dockerfile
CMD ["sleep 5"]
```

!!! bug
    Executable and arguments must be separate array elements.

Correct:

```dockerfile
CMD ["sleep","5"]
```

---

## ğŸ” CMD Is Replaced by Runtime Command

Dockerfile:

```dockerfile
CMD ["sleep","5"]
```

Runtime:

```bash
docker run myimg sleep 10
```

Final command:

```
sleep 10
```

!!! note
    Runtime command fully replaces CMD.

---

## ğŸšª ENTRYPOINT â€” Fixed Executable

ENTRYPOINT defines the **base executable**.

Runtime values are **appended as arguments**.

```dockerfile
ENTRYPOINT ["sleep"]
```

```bash
docker run myimg 10
```

Final command:

```
sleep 10
```

!!! abstract
    ENTRYPOINT = fixed program  
    CMD = default parameters

---

## âš ï¸ ENTRYPOINT Without Default Args

```dockerfile
ENTRYPOINT ["sleep"]
```

```bash
docker run myimg
```

Result:

```
sleep: missing operand
```

!!! warning
    ENTRYPOINT needs arguments â€” provide via CMD or runtime.

---

## âœ… Best Practice â€” ENTRYPOINT + CMD

```dockerfile
FROM ubuntu
ENTRYPOINT ["sleep"]
CMD ["5"]
```

=== "No runtime arg"

    ```bash
    docker run myimg
    ```

    Runs â†’ `sleep 5`

=== "With runtime arg"

    ```bash
    docker run myimg 20
    ```

    Runs â†’ `sleep 20`

!!! success
    ENTRYPOINT + CMD = best pattern for flexible containers.

---

## ğŸ”§ Override ENTRYPOINT at Runtime

```bash
docker run --entrypoint sleep2.0 myimg 30
```

!!! tip
    Useful for debugging or temporary overrides.

---

## ğŸ§­ Docker Startup Resolution Order

```
docker run command
      â†“
Replaces CMD
      â†“
Appended to ENTRYPOINT (if present)
      â†“
Final executed process
```

---

## ğŸ“Š CMD vs ENTRYPOINT â€” Quick Compare

| Behavior | CMD | ENTRYPOINT |
|-----------|------|------------|
Default executable | âœ… | âœ… |
Default args | âœ… | âŒ |
Runtime command | Replaces | Appends |
Best for | Defaults | Fixed program |

---

# â˜¸ï¸ Commands and Arguments in Kubernetes

Kubernetes lets you override container startup behavior using:

- `command`
- `args`

These map directly to Docker behavior.

---

## ğŸ¯ Core Idea â€” Pod Startup Control

Container startup inside a Pod can come from:

- Docker ENTRYPOINT
- Docker CMD
- Pod `command`
- Pod `args`

!!! note
    Kubernetes can override both ENTRYPOINT and CMD.

---

## ğŸ§± Mapping â€” Docker vs Kubernetes

| Docker | Kubernetes |
|----------|-------------|
ENTRYPOINT â¡ï¸ | command |
CMDâ¡ï¸ | args |

!!! tip
    command = executable  
    args = parameters

---

## â–¶ï¸ Default Behavior (No Pod Overrides)

Dockerfile:

```dockerfile
ENTRYPOINT ["sleep"]
CMD ["5"]
```

Pod:

```yaml
containers:
  - name: sleeper
    image: ubuntu-sleeper
```

Final command:

```
sleep 5
```

!!! success
    Image defaults are used.

---

## ğŸ”¢ Override Only Arguments (args)

Equivalent to:

```bash
docker run ubuntu-sleeper 10
```

Pod:

```yaml
containers:
  - name: sleeper
    image: ubuntu-sleeper
    args: ["10"]
```

Final command:

```
sleep 10
```

!!! note
    args overrides Docker CMD only.

---

## ğŸ” Override Executable (command)

Equivalent to Docker:

```bash
docker run --entrypoint sleep2.0 ubuntu-sleeper 10
```

Pod:

```yaml
containers:
  - name: sleeper
    image: ubuntu-sleeper
    command: ["sleep2.0"]
    args: ["10"]
```

Final command:

```
sleep2.0 10
```

!!! warning
    command replaces Docker ENTRYPOINT.

---

## ğŸ§­ Kubernetes Override Flow

```
Dockerfile ENTRYPOINT + CMD
        â†“
Image default command
        â†“
Pod args â†’ replaces CMD
Pod command â†’ replaces ENTRYPOINT
```

---

## âš ï¸ Common Mistake

Wrong:

```yaml
command: ["sleep 10"]
```

!!! bug
    Must be split into executable + argument.

Correct:

```yaml
command: ["sleep"]
args: ["10"]
```

---

## ğŸ§ª Minimal Test Pod

```yaml
apiVersion: v1
kind: Pod
metadata:
  name: demo
spec:
  containers:
    - name: sleeper
      image: ubuntu
      command: ["sleep"]
      args: ["15"]
```

---

## ğŸ§  Exam Checks

!!! question
    Which Pod field overrides Docker ENTRYPOINT?

command

!!! question
    Which Pod field overrides Docker CMD?

args

!!! question
    Are command and args arrays?

Yes â€” always list form.

---

## âœ… Final Summary

!!! summary

    - Containers run one main process
    - Docker CMD = default args
    - Docker ENTRYPOINT = fixed executable
    - Runtime command replaces CMD
    - Runtime args append to ENTRYPOINT
    - Kubernetes command â†” ENTRYPOINT
    - Kubernetes args â†” CMD
    - Always use JSON/list form
