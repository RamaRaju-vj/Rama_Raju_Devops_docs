# 2.12 Configuring Scheduler Profiles

Kubernetes **Scheduler Profiles** let you run multiple logical schedulers inside a **single scheduler binary**. Each profile behaves like an independent scheduler but shares the same process — reducing operational overhead and avoiding race conditions between multiple scheduler instances.

!!! info
    Scheduler Profiles were introduced in **Kubernetes v1.18+**.

---

## Why Scheduler Profiles

Before Scheduler Profiles, running multiple schedulers required:

- Separate scheduler binaries
- Separate configuration files
- Separate running processes

This led to:

- Higher maintenance overhead
- More resource usage
- Possible race conditions between schedulers

!!! note
    Scheduler Profiles allow multiple scheduler behaviors inside **one scheduler process** instead of running multiple scheduler services.

---

## What Is a Scheduler Profile

A **Scheduler Profile** is a configuration block inside the scheduler configuration file that defines:

- A unique scheduler name
- Plugin configuration
- Extension point behavior

Each profile:

- Acts like a separate logical scheduler
- Uses the same `kube-scheduler` binary
- Can behave differently through plugin settings

---

## How Pods Choose a Scheduler Profile

Pods select which scheduler profile to use with the `schedulerName` field.

```yaml
apiVersion: v1
kind: Pod
metadata:
  name: example-pod
spec:
  schedulerName: my-scheduler-2
  containers:
    - name: nginx
      image: nginx
```

If `schedulerName` is not specified, the **default profile (`default-scheduler`)** is used.

---

## Scheduler Profiles — Concept Diagram

```text
                    ┌──────────────────────────────┐
                    │        kube-scheduler        │
                    │        (single binary)       │
                    └──────────────┬───────────────┘
                                   │
        ┌──────────────────────────┼──────────────────────────┐
        │                          │                          │
        ▼                          ▼                          ▼

┌──────────────────┐     ┌──────────────────┐     ┌──────────────────┐
│ Profile A        │     │ Profile B        │     │ Profile C        │
│ schedulerName:   │     │ schedulerName:   │     │ schedulerName:   │
│ default-scheduler│     │ my-scheduler-2   │     │ my-scheduler-3   │
│                  │     │                  │     │                  │
│ Default plugins  │     │ Custom plugins   │     │ Scoring disabled │
└──────────────────┘     └──────────────────┘     └──────────────────┘

        │                          │                          │
        ▼                          ▼                          ▼

 Pods without              Pods with                   Pods with
 schedulerName      schedulerName=my-scheduler-2  schedulerName=my-scheduler-3
```

---

## Configuring Multiple Profiles

Multiple profiles are defined under the `profiles` section in the scheduler configuration.

### Example Configuration

```yaml
apiVersion: kubescheduler.config.k8s.io/v1
kind: KubeSchedulerConfiguration

profiles:

  - schedulerName: my-scheduler-2
    plugins:
      score:
        disabled:
          - name: TaintToleration
        enabled:
          - name: MyCustomPluginA
          - name: MyCustomPluginB

  - schedulerName: my-scheduler-3
    plugins:
      preScore:
        disabled:
          - name: "*"
      score:
        disabled:
          - name: "*"

  - schedulerName: my-scheduler-4
```

!!! tip
    Each profile can enable or disable plugins independently to change scheduling behavior.

---

## Scheduler Extension Points

Scheduler plugins run at different **extension points** during the scheduling cycle.

### Scheduling Flow Diagram

```text
Pod Enters Queue
      │
      ▼
┌──────────────┐
│ Queue Sort   │  → Example: PrioritySort
└──────┬───────┘
       ▼
┌──────────────┐
│ Filtering    │  → NodeResourcesFit, NodeAffinity, TaintToleration
└──────┬───────┘
       ▼
┌──────────────┐
│ Scoring      │  → ImageLocality, NodeResourcesFit
└──────┬───────┘
       ▼
┌──────────────┐
│ Binding      │  → DefaultBinder
└──────────────┘
```

### Major Extension Points

=== "Queue"
    - `queueSort`
    - Controls Pod ordering
    - Example: **PrioritySort**

=== "Filtering"
    - `preFilter`, `filter`, `postFilter`
    - Removes unsuitable nodes
    - Examples: NodeResourcesFit, NodeAffinity, TaintToleration

=== "Scoring"
    - `preScore`, `score`, `reserve`
    - Ranks remaining nodes
    - Examples: ImageLocality, NodeResourcesFit

=== "Binding"
    - `permit`, `preBind`, `bind`, `postBind`
    - Final node assignment
    - Example: DefaultBinder

---

## Plugin Customization Per Profile

Each scheduler profile can customize plugins independently.

You can:

- Enable specific plugins
- Disable specific plugins
- Disable all plugins using `"*"`
- Use custom plugins
- Change filtering and scoring behavior

!!! tip
    Profiles mainly differ by **plugin configuration**, not just scheduler name.

---

## Key Takeaways

!!! summary

    - Scheduler Profiles run multiple logical schedulers in one binary
    - Each profile has a unique `schedulerName`
    - Pods select profiles using `schedulerName`
    - Profiles customize plugin behavior
    - Reduces operational overhead
    - Avoids multi-scheduler race conditions
