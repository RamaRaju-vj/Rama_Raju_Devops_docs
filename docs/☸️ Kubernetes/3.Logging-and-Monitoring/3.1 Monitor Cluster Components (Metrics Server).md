# 3.1 Monitor Cluster Components (Metrics Server)

Kubernetes does not ship with a full monitoring stack by default, but it provides a **resource metrics pipeline** that lets you quickly check **CPU and memory usage of nodes and pods** using **Metrics Server**.


---

## ğŸ¯ What You Monitor in a Kubernetes Cluster

At a minimum, you should be able to see:

- Number of nodes
- Node health status
- Node CPU & memory usage
- Pod CPU & memory usage
- Which workloads are consuming resources

!!! note
    Builtâ€‘in metrics are **current usage only**. Historical graphs require tools like Prometheus or commercial monitoring platforms.

---

## ğŸ§© Monitoring Tool Options

Common solutions:

- **Metrics Server** â†’ lightweight, realâ€‘time usage
- **Prometheus** â†’ full metrics + history
- **Elastic Stack** â†’ logs + metrics
- **Datadog / Dynatrace** â†’ managed monitoring

!!! tip
    For CKA/CKAD exams and quick troubleshooting, **Metrics Server + kubectl top** is what you must know.

---

## ğŸ“¦ What is Metrics Server

Metrics Server is a **cluster addâ€‘on** that:

- Collects CPU & memory metrics
- Reads metrics from kubelets
- Aggregates node & pod usage
- Stores data **in memory only**
- Powers `kubectl top` commands

!!! warning
    Metrics Server is **not** for longâ€‘term storage or dashboards.

---

# âš™ï¸ How Metrics Are Collected

Metrics flow inside the cluster like this:

```
Pods â†’ cAdvisor â†’ kubelet â†’ Metrics Server â†’ kubectl top
```


Step by step:

1. Containers generate usage data
2. **cAdvisor** inside kubelet reads container stats
3. kubelet exposes metrics API
4. **Metrics Server** pulls metrics
5. `kubectl top` displays results

!!! abstract
    kubelet + cAdvisor = metric source, Metrics Server = metric aggregator.

---



User commands:

```bash
kubectl top node
kubectl top pod
```

These commands query Metrics Server â€” not kubelet directly.

---

## ğŸš€ Install Metrics Server

=== "Minikube"

    ```bash
    minikube addons enable metrics-server
    ```

    !!! success
        Fastest method for local clusters.

=== "Other Clusters"

    ```bash
    git clone https://github.com/kubernetes-sigs/metrics-server.git
    kubectl apply -f metrics-server/manifests/
    ```

    This deploys:
    
    - Deployment
    - Service
    - RBAC roles
    - ClusterRoleBindings

    !!! note
        Wait 1â€“2 minutes for metrics to appear.

---

## ğŸ“Š View Node Metrics

```bash
kubectl top node
```

Example:

```
NAME     CPU(cores)   MEMORY(bytes)
node1    166m         1373Mi
node2    36m          1046Mi
```

Shows:

- CPU in millicores
- Memory usage
- Current load

---

## ğŸ“Š View Pod Metrics

```bash
kubectl top pod
```

Example:

```
NAME    CPU(cores)   MEMORY(bytes)
nginx   12m          55Mi
redis   8m           40Mi
```

!!! example
    Quickly identify highâ€‘usage pods.

---

## ğŸ§  Exam Facts

!!! question
    Does Metrics Server store history?

No â€” memory only.

!!! question
    How many Metrics Servers per cluster?

Exactly **one**.

---

## âš ï¸ If Metrics Are Missing

If you see:

```
metrics not available
```

Check:

- Metrics Server pod running
- Deployment healthy
- Wait after install
- kubelet TLS settings compatible

---

## âœ… Quick Summary

!!! summary

    - Metrics Server gives live CPU/memory metrics
    - Uses kubelet + cAdvisor data
    - No historical storage
    - Enables kubectl top commands
    - Install via addon or manifests
    - Required knowledge for exams
