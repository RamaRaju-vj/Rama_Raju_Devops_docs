
# 3.2 Managing Application Logs

Kubernetes provides simple builtâ€‘in commands to **view application logs** from containers and pods.  


---

## ğŸ¯ Why Application Logs Matter

Application logs help you:

- Debug application failures
- Track user activity
- Inspect runtime errors
- Verify container behavior
- Troubleshoot pod crashes

!!! note
    Kubernetes itself does not provide longâ€‘term log storage. It only exposes container logs. Use external tools (ELK, Loki, etc.) for centralized logging.

---

## ğŸ³ Docker Logging Basics

Containers usually write logs to:

- **stdout**
- **stderr**

Docker captures these streams and makes them available via the Docker CLI.

### Run Container in Background

```bash
docker run -d kodekloud/event-simulator
```

Since it runs in detached mode, logs are not shown in the terminal.

### View Docker Logs

```bash
docker logs <container-id>
```

### Stream Logs Live

```bash
docker logs -f <container-id>
```

!!! tip
    `-f` means **follow** â€” stream logs in real time.

---

## ğŸ§­ Docker Logging Flow (Diagram)

```
Application inside container
        â”‚
        â–¼
 stdout / stderr
        â”‚
        â–¼
 Docker runtime
        â”‚
        â–¼
 docker logs / docker logs -f
```

---

## â˜¸ï¸ Kubernetes Logging Basics

In Kubernetes, logs are accessed using:

```bash
kubectl logs
```

Kubernetes reads container stdout/stderr through **kubelet** running on each node.

!!! abstract
    kubectl â†’ API Server â†’ kubelet â†’ container logs

---

## ğŸ”„ Kubernetes Logging Flow (Diagram)

```
Container Application
        â”‚
        â–¼
 stdout / stderr
        â”‚
        â–¼
 kubelet (node agent)
        â”‚
        â–¼
 Kubernetes API Server
        â”‚
        â–¼
 kubectl logs
```

---

## ğŸš€ Create Pod for Log Demo

Example pod using event simulator image:

```yaml
apiVersion: v1
kind: Pod
metadata:
  name: event-simulator-pod
spec:
  containers:
    - name: event-simulator
      image: kodekloud/event-simulator
```

Create pod:

```bash
kubectl apply -f event-simulator.yaml
```

---

## ğŸ“„ View Pod Logs (Single Container)

```bash
kubectl logs event-simulator-pod
```

### Stream Logs Live

```bash
kubectl logs -f event-simulator-pod
```

!!! success
    Behavior is similar to `docker logs -f`.

---

## ğŸ“¦ Multiâ€‘Container Pod Logging

Pods can contain **multiple containers**.

Example:

```yaml
apiVersion: v1
kind: Pod
metadata:
  name: event-simulator-pod
spec:
  containers:
    - name: event-simulator
      image: kodekloud/event-simulator

    - name: image-processor
      image: some-image-processor
```

---

## â— Logs Command Without Container Name

```bash
kubectl logs event-simulator-pod
```

Result:

- Command fails
- Kubernetes asks for container name

!!! warning
    For multiâ€‘container pods, container name is required.

---

## âœ… Correct Multiâ€‘Container Command

```bash
kubectl logs -f event-simulator-pod event-simulator
```

Format:

```
kubectl logs -f <pod-name> <container-name>
```

---

## ğŸ§­ Multiâ€‘Container Log Selection (Diagram)

```
Pod
 â”œâ”€â”€ container: event-simulator
 â””â”€â”€ container: image-processor

kubectl logs pod â†’ âŒ ambiguous
kubectl logs pod event-simulator â†’ âœ… works
```

---

## ğŸ” Useful Log Options

### Previous Container Logs (After Crash)

```bash
kubectl logs --previous <pod>
```

!!! example
    Useful when a container restarted and you need logs from the previous run.

---

### Logs with Namespace

```bash
kubectl logs -n dev mypod
```

---

## ğŸ§  Exam Tips

!!! question
    Where do Kubernetes container logs come from?

From container **stdout/stderr**, captured by kubelet.

---

!!! question
    Do you need extra setup to view pod logs?

No â€” builtâ€‘in with `kubectl logs`.

---

!!! question
    What if a pod has multiple containers?

You must specify the **container name**.

---

## âš ï¸ Limitations

!!! warning
    - No builtâ€‘in longâ€‘term retention  
    - Logs lost if container is removed  
    - Use centralized logging for production

---

## âœ… Quick Summary

!!! summary

    - Applications log to stdout/stderr
    - Docker â†’ docker logs
    - Kubernetes â†’ kubectl logs
    - Use -f to stream logs
    - Multiâ€‘container pods require container name
    - kubelet provides container logs
    - No builtâ€‘in longâ€‘term storage

---
# Centralized Logging Tools for Kubernetes (Production Guide)

Centralized logging in production Kubernetes environments is used to:

- Collect logs from all nodes and pods
- Aggregate logs in one place
- Store logs long-term
- Search and filter logs quickly
- Visualize logs with dashboards
- Trigger alerts on errors and patterns

Instead of checking logs pod-by-pod, centralized logging gives you **cluster-wide visibility**.

---

# ğŸ¯ Why Centralized Logging Is Needed

Default Kubernetes logging:

- Uses `kubectl logs`
- Reads container stdout/stderr
- No long-term retention
- No cross-pod search
- No built-in dashboards

!!! warning
    Production clusters should always use a centralized logging stack instead of relying only on kubectl logs.

---

# ğŸ—ï¸ Common Kubernetes Logging Architecture

Typical centralized logging pipeline:

```
Pods / Containers
      â†“
Node Log Collector (DaemonSet)
      â†“
Log Aggregator / Storage
      â†“
Search + Dashboard UI
```

Collectors usually run as a **DaemonSet** on every node and read:

- /var/log/containers
- container runtime logs

---

# âœ… Most Popular Open Source Logging Stacks

## ğŸ“¦ ELK Stack

ELK = Elasticsearch + Logstash + Kibana

Components:

- Elasticsearch â†’ stores and indexes logs
- Logstash â†’ parses and transforms logs
- Kibana â†’ dashboards and search UI

Typical flow:

```
Pods â†’ Fluentd â†’ Logstash â†’ Elasticsearch â†’ Kibana
```

Pros:

- Very powerful search
- Rich dashboards
- Mature ecosystem

Cons:

- Heavy resource usage
- More operational overhead

---

## âš¡ EFK Stack (Kubernetes Favorite)

EFK = Elasticsearch + Fluentd + Kibana

Logstash is replaced by Fluentd.

Flow:

```
Containers â†’ Fluentd (DaemonSet) â†’ Elasticsearch â†’ Kibana
```

Pros:

- Kubernetes-friendly
- Easier than full ELK
- Widely used in clusters

Cons:

- Still resource heavy
- Elasticsearch needs tuning

!!! tip
    EFK is the most common open-source Kubernetes logging stack.

---

## ğŸª¶ Fluent Bit (Lightweight Collector)

Fluent Bit is a lightweight log shipper often used instead of Fluentd.

Flow:

```
Containers â†’ Fluent Bit â†’ Backend (Elastic / Loki / Cloud)
```

Pros:

- Very low CPU and memory
- Fast
- Ideal for large clusters

Cons:

- Less processing capability than Fluentd

---

# ğŸ“Š Modern Lightweight Alternative

## ğŸŸ£ Grafana Loki Stack

Loki + Promtail + Grafana

Components:

- Loki â†’ log storage
- Promtail â†’ log collector
- Grafana â†’ dashboards

Flow:

```
Pods â†’ Promtail â†’ Loki â†’ Grafana
```

Pros:

- Much cheaper than Elasticsearch
- Label-based indexing
- Simple to operate
- Fast growing adoption

Cons:

- Different query model than ELK

---

# â˜ï¸ Managed Cloud Logging Platforms

## ğŸŸ¦ AWS CloudWatch Logs

Used with EKS.

Flow:

```
Pods â†’ Fluent Bit â†’ CloudWatch Logs
```

Features:

- Fully managed
- Built-in alerts
- No storage management
- Native AWS integration

---

## ğŸŸ¥ Azure Monitor / Log Analytics

Used with AKS.

Features:

- Container Insights
- Central dashboards
- Integrated metrics + logs
- Managed service

---

## ğŸŸ¨ Google Cloud Logging

Used with GKE.

Features:

- Automatic log collection
- No setup required
- Integrated with GCP monitoring
- Built-in search and alerts

---

# ğŸ’¼ Enterprise / SaaS Logging Tools

## ğŸ“ˆ Datadog

- Logs + metrics + traces
- Strong Kubernetes integration
- Excellent dashboards
- SaaS platform

---

## ğŸ§  Splunk

- Enterprise log analytics
- Advanced search and correlation
- Large-scale deployments
- Compliance-friendly

---

## ğŸ” Dynatrace

- Full observability platform
- Logs + APM + infrastructure metrics
- AI-assisted analysis

---

# ğŸ§° Kubernetes Deployment Pattern

Most production setups use:

- DaemonSet log collectors:
  - Fluentd
  - Fluent Bit
  - Promtail

Collectors:

- Run on every node
- Read container log files
- Forward logs to backend storage

---

# ğŸ† Production Recommendations

## ğŸ¥‡ Most Common Open Source Stack
EFK (Elasticsearch + Fluentd + Kibana)

## ğŸ¥ˆ Lightweight Modern Stack
Loki + Promtail + Grafana

## ğŸ¥‰ Easiest for Cloud Clusters
Cloud provider logging:

- CloudWatch (AWS)
- Azure Monitor
- Google Cloud Logging

---

# âœ… Quick Summary

!!! summary

    - kubectl logs is not enough for production
    - Use centralized logging stacks
    - Most common: EFK
    - Lightweight option: Loki
    - Best for cloud: managed logging services
    - Use DaemonSets for node-level log collection
